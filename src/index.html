<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel="stylesheet">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RobotJockey</title>
  <link rel="stylesheet" href="index.css">
</head>


<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h1 class="monoton-regular">Robot<br /><span class="second-line">Jockey</span></h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">Search</a>
      <a href="#">Your Library</a>
    </nav>
  </div>

  <!-- Header -->
  <div class="header">
    <input type="text" id="songInput" placeholder="What do you want to listen to?" />
  </div>

  <!-- Main Content -->
  <div class="content">
    <div class="playlist">
      <h2>Playlist</h2>
      <ul id="playlist"></ul>
    </div>
  </div>

  <!-- Player Controls -->
  <div class="player">
    <div class="player-controls">
      <button id="prev">
        <svg viewBox="0 0 24 24">
          <path d="M6 19.5V4.5H8.5V19.5H6ZM9.5 12L20 19.5V4.5L9.5 12Z" />
        </svg>
      </button>

      <button id="playPause" class="play-btn">
        <svg id="playIcon" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z" />
        </svg>
        <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none;">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
        </svg>
      </button>

      <button id="next">
        <svg viewBox="0 0 24 24">
          <path d="M16.5 4.5V19.5H19V4.5H16.5ZM14.5 12L4 4.5V19.5L14.5 12Z" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Hidden Audio Element -->
  <audio id="audio"></audio>

  <script>
    const playlist = document.getElementById("playlist");
    const audio = document.getElementById("audio");
    const playPauseBtn = document.getElementById("playPause");
    const playIcon = document.getElementById("playIcon");
    const pauseIcon = document.getElementById("pauseIcon");
    const nextBtn = document.getElementById("next");
    const prevBtn = document.getElementById("prev");
    const songInput = document.getElementById("songInput");

    let songs = [];

    let currentIndex = 0;
    let isPlaying = false;

    function renderPlaylist(songs) {
      playlist.innerHTML = "";
      songs.forEach((song, i) => {
        const li = document.createElement("li");
        li.innerHTML = `${song.title} <span>${song.artist}</span>`;
        li.dataset.index = i;
        if (i === currentIndex) li.classList.add("active");
        playlist.appendChild(li);
      });
    }

    function highlightSong() {
      [...playlist.children].forEach((li, i) => {
        li.classList.toggle("active", i === currentIndex);
      });
    }

    function loadSong(index) {
      if (!songs[index]) return;
      audio.src = "file:///X:/Downloads/miwu.mp3"
      console.log("Now playing:", songs[index].title);
      console.log("Artist:", songs[index].artist);
      console.log("Source:", songs[index].src);
      audio.play();
      currentIndex = index;
      highlightSong();
      isPlaying = true;
      updatePlayPause();
    }

    function updatePlayPause() {
      if (isPlaying)
      {
        playIcon.style.display = "none";
        pauseIcon.style.display = "block";
      } else
      {
        playIcon.style.display = "block";
        pauseIcon.style.display = "none";
      }
    }

    playPauseBtn.addEventListener("click", () => {
      if (!audio.src)
      {
        loadSong(currentIndex);
      } else if (isPlaying)
      {
        audio.pause();
        isPlaying = false;
        updatePlayPause();
      } else
      {
        audio.play();
        isPlaying = true;
        updatePlayPause();
      }
    });

    nextBtn.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % songs.length;
      loadSong(currentIndex);
    });

    prevBtn.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + songs.length) % songs.length;
      loadSong(currentIndex);
    });

    playlist.addEventListener("click", (e) => {
      if (e.target.closest("li"))
      {
        const index = e.target.closest("li").dataset.index;
        loadSong(Number(index));
      }
    });

    songInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && songInput.value.trim())
      {
        songInput.value = "";
      }
    });

    audio.addEventListener("ended", () => {
      currentIndex = (currentIndex + 1) % songs.length;
      loadSong(currentIndex);
    });

    window.electronAPI.onPlaylistUpdate((newPlaylist) => {
      console.log("Playlist updated:", newPlaylist);
      // force variable + UI update
      document.getElementById("playlist").innerHTML =
        newPlaylist.map(song => `<li>${song}</li>`).join("");
      songs = newPlaylist
      renderPlaylist(newPlaylist);
    });
    // init
    //renderPlaylist();
    updatePlayPause();
  </script>
</body>

</html>